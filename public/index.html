<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta
    name="viewport"
    content="width=device-width,initial-scale=1,viewport-fit=cover"
  />
  <title>WorkAI Deck</title>
  <style>
    :root {
      --bg: #f5f5f7;
      --bg-soft: #ffffff;
      --ink: #111827;
      --muted: #6b7280;
      --accent: #c41e3a; /* Cardinal red */
      --accent-soft: rgba(196, 30, 58, 0.08);
      --border: rgba(15, 23, 42, 0.12);
      --radius-xl: 22px;
      --shadow-soft: 0 14px 40px rgba(15, 23, 42, 0.12);
      --font: Inter, system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
    }

    body {
      margin: 0;
      padding: 0;
      background: var(--bg);
      color: var(--ink);
      font-family: var(--font);
    }

    .shell {
      max-width: 1120px;
      margin: 0 auto;
      padding: 18px 14px 22px;
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    header {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .brand-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 10px;
    }

    .logo {
      font-weight: 600;
      font-size: 18px;
      letter-spacing: 0.02em;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .logo-mark {
      width: 14px;
      height: 14px;
      border-radius: 5px;
      background: var(--accent);
      box-shadow: 0 0 10px var(--accent-soft);
    }

    .hero-label {
      font-size: 9px;
      color: var(--muted);
      text-transform: uppercase;
      letter-spacing: 0.16em;
    }

    h1 {
      margin: 0;
      font-size: 24px;
      font-weight: 600;
      color: var(--ink);
    }

    .sub {
      font-size: 13px;
      color: var(--muted);
      max-width: 520px;
    }

    .bullets {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 4px;
    }

    .pill {
      padding: 4px 9px;
      border-radius: 999px;
      border: 1px solid var(--border);
      font-size: 9px;
      color: var(--muted);
      display: inline-flex;
      align-items: center;
      gap: 5px;
    }

    .pill-dot {
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: var(--accent);
    }

    .layout {
      display: grid;
      grid-template-columns: minmax(0, 1.8fr) minmax(260px, 1.2fr);
      gap: 14px;
      align-items: flex-start;
    }

    @media (max-width: 900px) {
      .layout {
        grid-template-columns: 1fr;
      }
    }

    .panel {
      background: var(--bg-soft);
      border-radius: var(--radius-xl);
      border: 1px solid var(--border);
      box-shadow: var(--shadow-soft);
      padding: 12px;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .panel-title {
      font-size: 11px;
      font-weight: 600;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 6px;
    }

    .panel-sub {
      font-size: 10px;
      color: var(--muted);
    }

    .lane-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 4px;
    }

    .lane-pill {
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid var(--border);
      font-size: 10px;
      color: var(--muted);
      cursor: pointer;
      background: transparent;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      transition: all 0.16s ease-out;
    }

    .lane-pill span.badge {
      width: 7px;
      height: 7px;
      border-radius: 999px;
      background: var(--border);
    }

    .lane-pill.active {
      border-color: var(--accent);
      background: var(--accent-soft);
      color: var(--accent);
    }

    .lane-pill.active span.badge {
      background: var(--accent);
    }

    .dropzone {
      margin-top: 8px;
      padding: 14px 10px;
      border-radius: 16px;
      border: 1px dashed var(--border);
      background: #fafafa;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      cursor: pointer;
      transition: all 0.18s ease-out;
    }

    .drop-main {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .drop-title {
      font-size: 12px;
      font-weight: 500;
      color: var(--ink);
    }

    .drop-sub {
      font-size: 10px;
      color: var(--muted);
    }

    .button-primary {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 8px 14px;
      border-radius: 999px;
      border: none;
      background: var(--accent);
      color: #ffffff;
      font-size: 10px;
      font-weight: 500;
      cursor: pointer;
      white-space: nowrap;
    }

    input[type="file"] {
      display: none;
    }

    .hint {
      font-size: 9px;
      color: var(--muted);
    }

    .deck-wrap {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .deck-label {
      font-size: 10px;
      font-weight: 500;
      color: var(--ink);
    }

    .cards {
      display: flex;
      flex-direction: row;
      gap: 10px;
      overflow-x: auto;
      padding-bottom: 4px;
    }

    .cards::-webkit-scrollbar {
      height: 4px;
    }

    .cards::-webkit-scrollbar-thumb {
      background: rgba(148, 163, 253, 0.35);
      border-radius: 999px;
    }

    .card {
      min-width: 210px;
      max-width: 230px;
      border-radius: 18px;
      border: 1px solid var(--border);
      background: var(--bg-soft);
      box-shadow: var(--shadow-soft);
      padding: 8px;
      display: flex;
      flex-direction: column;
      gap: 4px;
      font-size: 9px;
    }

    .card-label {
      font-size: 8px;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      color: var(--muted);
    }

    .card-label strong {
      color: var(--accent);
      font-weight: 600;
    }

    .card-img {
      width: 100%;
      height: 90px;
      border-radius: 12px;
      background-size: cover;
      background-position: center;
      background-color: #f3f4f6;
      margin: 2px 0;
    }

    .card-range-label {
      font-size: 8px;
      color: var(--muted);
    }

    .card-range {
      font-size: 12px;
      font-weight: 600;
      color: var(--accent);
    }

    .card-notes {
      font-size: 9px;
      color: var(--ink);
    }

    .card-meta {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 7px;
      color: var(--muted);
      gap: 4px;
      margin-top: 2px;
    }

    .dot-green {
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: #16a34a;
    }

    .empty {
      font-size: 9px;
      color: var(--muted);
      padding: 4px 2px 0;
    }

    /* Right side: how it works / trust */
    .steps {
      display: flex;
      flex-direction: column;
      gap: 6px;
      font-size: 9px;
      color: var(--muted);
    }

    .steps strong {
      color: var(--ink);
      font-size: 10px;
    }

    .trust {
      font-size: 9px;
      color: var(--muted);
      border-top: 1px solid var(--border);
      padding-top: 6px;
      margin-top: 2px;
    }
  </style>
</head>
<body>
  <div class="shell">
    <header>
      <div class="brand-row">
        <div class="logo">
          <span class="logo-mark"></span>
          WorkAI Deck
        </div>
      </div>
      <div class="hero-label">PRICING COMPANION FOR REAL OPERATORS</div>
      <h1>Snap the job. Get a sane range.</h1>
      <div class="sub">
        For mowing, pressure washing, junk removal, and handyman work. One photo becomes a clean pricing card you can stand behind.
      </div>
      <div class="bullets">
        <div class="pill"><span class="pill-dot"></span>Built from real field work</div>
        <div class="pill"><span class="pill-dot"></span>No login. No spam.</div>
        <div class="pill"><span class="pill-dot"></span>Private to your device</div>
      </div>
    </header>

    <div class="layout">
      <!-- LEFT: Upload + Deck -->
      <section class="panel">
        <div class="panel-title">
          <span>Create a pricing card</span>
        </div>
        <div class="panel-sub">
          Pick the lane you’re quoting, add a photo, and we’ll return a band instead of a blind guess.
        </div>

        <!-- Lane selection -->
        <div class="lane-row" id="laneRow">
          <button class="lane-pill active" data-lane="mowing">
            <span class="badge"></span>Mowing
          </button>
          <button class="lane-pill" data-lane="pressure_washing">
            <span class="badge"></span>Pressure Washing
          </button>
          <button class="lane-pill" data-lane="junk_removal">
            <span class="badge"></span>Junk Removal
          </button>
          <button class="lane-pill" data-lane="handyman">
            <span class="badge"></span>Handyman
          </button>
        </div>

        <!-- Upload -->
        <div id="dropzone" class="dropzone">
          <div class="drop-main">
            <div class="drop-title">Drop a photo or tap to upload</div>
            <div class="drop-sub">We’ll turn this into a private card for this device only.</div>
          </div>
          <button class="button-primary" type="button">
            Use camera / upload
          </button>
        </div>
        <input id="fileInput" type="file" accept="image/*,video/*" />

        <div class="hint" id="uploadMsg"></div>

        <!-- Deck -->
        <div class="deck-wrap">
          <div class="deck-label">Your deck</div>
          <div id="cards" class="cards">
            <!-- example card so it never feels empty -->
            <article class="card">
              <div class="card-label"><strong>Mowing card</strong> • sample</div>
              <div class="card-img" style="background-image:linear-gradient(135deg,#e5e7eb,#9ca3af);"></div>
              <div class="card-range-label">Suggested range</div>
              <div class="card-range">$55 – $75</div>
              <div class="card-notes">Standard weekly cut, front + back, easy access.</div>
              <div class="card-meta">
                <div><span class="dot-green"></span> Private to this device</div>
                <div>Sample</div>
              </div>
            </article>
          </div>
          <div id="emptyState" class="empty">
            Your first upload becomes Card #001. Use real jobs.
          </div>
        </div>
      </section>

      <!-- RIGHT: How it works / trust -->
      <aside class="panel">
        <div class="panel-title">
          <span>How it works</span>
        </div>
        <div class="steps">
          <div><strong>1. Snap the job.</strong> Use a clear photo of the actual work.</div>
          <div><strong>2. We apply guardrails.</strong> Each lane uses its own ranges and rules to keep numbers sane.</div>
          <div><strong>3. You quote with confidence.</strong> Use the band as your fast check, not a script.</div>
        </div>
        <div class="trust">
          Built from real service work, not theory. Designed for operators who care about showing up right, charging fair, and staying consistent.
        </div>
      </aside>
    </div>
  </div>

  <script>
    const API_BASE = window.location.origin;

    const laneRow = document.getElementById("laneRow");
    const dropzone = document.getElementById("dropzone");
    const fileInput = document.getElementById("fileInput");
    const cardsEl = document.getElementById("cards");
    const emptyEl = document.getElementById("emptyState");
    const uploadMsg = document.getElementById("uploadMsg");

    let selectedLane = "mowing";

    laneRow.addEventListener("click", (e) => {
      const btn = e.target.closest(".lane-pill");
      if (!btn) return;
      document
        .querySelectorAll(".lane-pill")
        .forEach((b) => b.classList.remove("active"));
      btn.classList.add("active");
      selectedLane = btn.getAttribute("data-lane");
    });

    dropzone.addEventListener("click", () => fileInput.click());

    dropzone.addEventListener("dragover", (e) => {
      e.preventDefault();
      dropzone.style.borderColor = "var(--accent)";
      dropzone.style.background = "#fef2f2";
    });

    dropzone.addEventListener("dragleave", (e) => {
      e.preventDefault();
      resetDropzoneStyle();
    });

    dropzone.addEventListener("drop", (e) => {
      e.preventDefault();
      resetDropzoneStyle();
      const files = Array.from(e.dataTransfer.files || []);
      if (files.length) handleFiles(files);
    });

    function resetDropzoneStyle() {
      dropzone.style.borderColor = "var(--border)";
      dropzone.style.background = "#fafafa";
    }

    fileInput.addEventListener("change", (e) => {
      const files = Array.from(e.target.files || []);
      if (files.length) handleFiles(files);
      fileInput.value = "";
    });

    async function handleFiles(files) {
      uploadMsg.textContent = "";
      for (const file of files) {
        try {
          const job = await uploadJob(file);
          prependCard(job, true);
        } catch (err) {
          console.error(err);
          uploadMsg.textContent = err.message || "Upload failed.";
        }
      }
      refreshEmptyState();
    }

    async function uploadJob(file) {
      const form = new FormData();
      form.append("media", file);
      form.append("scopeType", selectedLane);
      form.append("description", "");
      form.append("price", "");

      const res = await fetch(`${API_BASE}/api/jobs/upload`, {
        method: "POST",
        body: form
      });

      if (!res.ok) {
        let errText = "Upload failed.";
        try {
          const err = await res.json();
          if (err && err.error) errText = err.error;
        } catch {}
        throw new Error(errText);
      }

      const data = await res.json();
      if (!data.ok || !data.job) {
        throw new Error("Unexpected response.");
      }
      uploadMsg.textContent = "Card created.";
      return data.job;
    }

    async function loadJobs() {
      try {
        const res = await fetch(`${API_BASE}/api/jobs/list`);
        if (!res.ok) return;
        const jobs = await res.json();
        // clear everything except the sample card
        cardsEl.innerHTML = "";
        (jobs || []).forEach((j) => prependCard(j, false));
        refreshEmptyState();
      } catch (e) {
        console.warn("Could not load jobs", e);
      }
    }

    function prependCard(job, isNew) {
      if (!job) return;
      emptyEl.style.display = "none";

      const lane = (job.scopeType || "mowing")
        .replace("_", " ")
        .replace(/\b\w/g, (c) => c.toUpperCase());

      const created = job.createdAt ? new Date(job.createdAt) : new Date();
      const when = created.toLocaleString([], {
        month: "short",
        day: "numeric",
        hour: "numeric",
        minute: "2-digit"
      });

      const mediaUrl =
        (job.media && job.media.url) ||
        (job.media && job.media.startsWith("http")
          ? job.media
          : job.media
          ? `${API_BASE}${job.media}`
          : "");

      const low = job.aiLow || job.price || "?";
      const high = job.aiHigh || job.price || "?";
      const notes =
        job.description && job.description.trim().length
          ? job.description.trim()
          : "Notes from this photo.";

      const card = document.createElement("article");
      card.className = "card";

      card.innerHTML = `
        <div class="card-label"><strong>${lane} card</strong>${isNew ? " • new" : ""}</div>
        <div class="card-img" style="${
          mediaUrl
            ? `background-image:url('${mediaUrl.replace(/'/g, "\\'")}');`
            : "background-image:linear-gradient(135deg,#e5e7eb,#9ca3af);"
        }"></div>
        <div class="card-range-label">Suggested range</div>
        <div class="card-range">$${low} – $${high}</div>
        <div class="card-notes">${escapeHtml(notes)}</div>
        <div class="card-meta">
          <div><span class="dot-green"></span> Private to this device</div>
          <div>${when}</div>
        </div>
      `;

      cardsEl.prepend(card);
    }

    function refreshEmptyState() {
      const count = cardsEl.children.length;
      emptyEl.style.display = count === 0 ? "block" : "none";
    }

    function escapeHtml(str) {
      return (str || "")
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;");
    }

    // init: load existing cards from backend
    loadJobs();
  </script>
</body>
</html>
